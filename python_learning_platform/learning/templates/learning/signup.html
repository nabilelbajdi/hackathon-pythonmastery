{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}Sign Up - PythonMastery{% endblock title %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <h1 class="text-center mb-4">Join PythonMastery</h1>
        <div class="card shadow">
            <div class="card-body">
                <h2 class="card-title text-center mb-4">Create Your Account</h2>
                <form method="post" novalidate>
                    {% csrf_token %}
                    {% for field in form %}
                        <div class="mb-3 position-relative">
                            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas {% if field.name == 'username' %}fa-user{% elif field.name == 'email' %}fa-envelope{% else %}fa-lock{% endif %}"></i>
                                </span>
                                {% render_field field class="form-control" %}
                                {% if 'password' in field.name %}
                                    <i class="fas fa-eye password-toggle" data-target="{{ field.id_for_label }}"></i>
                                {% endif %}
                            </div>
                            {% if 'password' in field.name %}
                                {% if field.name == 'password1' %}
                                    <div class="password-strength-meter mt-2">
                                        <div id="password-strength-meter" class="progress">
                                            <div id="password-strength-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <small id="password-strength-text" class="form-text text-muted"></small>
                                {% endif %}
                            {% endif %}
                            {% if field.errors %}
                                <div class="alert alert-danger mt-2">
                                    {{ field.errors }}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">Sign Up</button>
                    </div>
                </form>
            </div>
        </div>
        <p class="text-center mt-3">
            Already have an account? <a href="{% url 'login' %}">Log in here</a>
        </p>
    </div>
</div>
{% endblock content %}

{% block extra_css %}
<style>
    .input-group {
        position: relative;
    }
    .password-toggle {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        z-index: 10;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleIcons = document.querySelectorAll('.password-toggle');
        toggleIcons.forEach(icon => {
            icon.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);

                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    this.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    this.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });
        });
    });

    function checkPasswordStrength(password) {
        const strengthMeter = document.getElementById("password-strength-bar");
        const strengthText = document.getElementById("password-strength-text");

        const criteria = [
            { regex: /.{8,}/, points: 1 },
            { regex: /[a-z]/, points: 1 },
            { regex: /[A-Z]/, points: 1 },
            { regex: /[0-9]/, points: 1 },
            { regex: /[^A-Za-z0-9]/, points: 1 }
        ];

        const strength = criteria.reduce((acc, criterion) => 
            acc + (criterion.regex.test(password) ? criterion.points : 0), 0);

        const strengthLevels = [
            { color: "#ff4d4d", text: "Very Weak" },
            { color: "#ffa64d", text: "Weak" },
            { color: "#ffff4d", text: "Moderate" },
            { color: "#4dff4d", text: "Strong" },
            { color: "#1a8cff", text: "Very Strong" }
        ];

        strengthMeter.style.width = `${(strength / 5) * 100}%`;
        strengthMeter.style.backgroundColor = strengthLevels[strength - 1].color;
        strengthText.textContent = strengthLevels[strength - 1].text;
    }

    document.getElementById('id_password1').addEventListener('input', function() {
        checkPasswordStrength(this.value);
    });
</script>
{% endblock extra_js %}
